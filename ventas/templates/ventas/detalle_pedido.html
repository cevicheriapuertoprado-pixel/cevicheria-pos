{% extends "base.html" %}

{% block content %}
<div class="container py-4">

  <!-- Encabezado -->
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4">
    <h2 class="fw-bold text-primary">
      <i class="bi bi-table me-2"></i>Mesa {{ pedido.mesa.numero }} - Pedido #{{ pedido.id }}
    </h2>
    <a href="{% url 'lista_mesas' %}" class="btn btn-outline-primary mt-2 mt-md-0">
      <i class="bi bi-arrow-left-circle me-1"></i> Volver a Mesas
    </a>
  </div>

  <!-- Secci√≥n del pedido actual -->
  <div class="mb-5">
    <h4 class="fw-bold text-secondary mb-3">
      <i class="bi bi-journal-text me-2"></i> Platos en este pedido
    </h4>

    {% if pedido.detalles.all %}
      <ul class="list-group shadow rounded-3">
        {% for detalle in pedido.detalles.all %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <span class="fw-semibold">{{ detalle.plato.nombre }}</span>
              <small class="text-muted">(x{{ detalle.cantidad }})</small>
            </div>
            <div>
              <span class="fw-bold text-success">S/. {{ detalle.subtotal|floatformat:2 }}</span>
              {% if not pedido.cerrado %}
                <a href="{% url 'quitar_plato' pedido.id detalle.plato.id %}" 
                   class="btn btn-outline-danger btn-sm ms-2">
                  <i class="bi bi-dash-circle"></i> Quitar
                </a>
              {% endif %}
            </div>
          </li>
        {% endfor %}
      </ul>

      <!-- Totales y botones -->
      <div class="mt-3 d-flex flex-wrap justify-content-end align-items-center gap-2">
        <h5 class="mb-0 me-3 text-dark">
          Total: <strong class="text-primary">S/. {{ pedido.total|floatformat:2 }}</strong>
        </h5>

        <!-- Botones de impresi√≥n -->
        <a href="{% url 'imprimir_ticket' pedido.id 'cocina' %}" 
           target="_blank" class="btn btn-outline-info btn-sm">
          <i class="bi bi-printer me-1"></i> Cocina
        </a>
        <a href="{% url 'imprimir_ticket' pedido.id 'cliente' %}" 
           target="_blank" class="btn btn-outline-primary btn-sm">
          <i class="bi bi-receipt-cutoff me-1"></i> Cliente
        </a>

        <!-- Bot√≥n cerrar pedido -->
        {% if not pedido.cerrado %}
          <a href="{% url 'cerrar_pedido' pedido.id %}" 
             class="btn btn-danger btn-sm">
            <i class="bi bi-x-circle me-1"></i> Cerrar pedido
          </a>
        {% else %}
          <span class="badge bg-danger p-2"><i class="bi bi-lock-fill"></i> Pedido cerrado</span>
        {% endif %}
      </div>
    {% else %}
      <p class="text-muted mt-2"><i class="bi bi-exclamation-circle"></i> No hay platos en este pedido a√∫n.</p>
    {% endif %}
  </div>

  {% if not pedido.cerrado %}
  <!-- Buscador -->
  <div class="mb-3">
    <input type="text" id="buscador" class="form-control form-control-lg border-primary" placeholder="üîç Buscar en la carta...">
  </div>

  <!-- Lista de platos -->
  <div id="lista-platos" class="row g-3">
    {% for plato in platos %}
      <div class="col-12 col-md-6">
        <div class="card plato-item shadow-sm border-0">
          <div class="card-body d-flex justify-content-between align-items-center">
            <span class="fw-semibold">{{ plato.nombre }}</span>
            <span>
              <span class="text-primary fw-bold">S/. {{ plato.precio|floatformat:2 }}</span>
              <a href="{% url 'agregar_plato' pedido.id plato.id %}" 
                 class="btn btn-success btn-sm ms-2">
                <i class="bi bi-plus-circle"></i> Agregar
              </a>
            </span>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
  {% endif %}

</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById("buscador")?.addEventListener("input", function() {
  const filtro = this.value.toLowerCase();
  document.querySelectorAll(".plato-item").forEach(item => {
    const texto = item.innerText.toLowerCase();
    item.style.display = texto.includes(filtro) ? "block" : "none";
  });
});
</script>
{% endblock %}

{% block extra_css %}
<style>
body {
  background: #f4f9fc;
}

/* Lista y tarjetas */
.list-group-item {
  border-left: 5px solid #0d6efd;
  transition: transform 0.2s ease;
}
.list-group-item:hover {
  transform: translateX(4px);
  background: #f8f9fa;
}

.plato-item {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.plato-item:hover {
  transform: scale(1.02);
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
}
</style>
{% endblock %}
