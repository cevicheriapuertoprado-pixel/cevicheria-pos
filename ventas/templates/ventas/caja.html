{% extends "base.html" %}
{% load static %}

{% block content %}
<canvas id="particles-bg"></canvas>

<div class="detalle-caja-container position-relative" style="z-index:1;">
  <div class="detalle-caja-card" data-aos="fade-up">
    <h2 class="titulo neon-yellow glow">ðŸ’° Caja del DÃ­a</h2>
    <p class="subtitulo text-muted">GestiÃ³n de la caja â€” apertura, cierre y resumen.</p>

    {% if caja %}
      <!-- Info Caja -->
      <div class="info-line">
        <span>Monto inicial:</span>
        <strong>S/. {{ caja.monto_inicial|floatformat:2 }}</strong>
      </div>
      <div class="info-line">
        <span>Total vendido:</span>
        <strong>S/. {{ caja.total_vendido|default:0|floatformat:2 }}</strong>
      </div>
      <div class="info-line">
        <span>Monto final:</span>
        <strong>S/. {{ caja.monto_final|floatformat:2 }}</strong>
      </div>

      {% if caja.abierta %}
        <div class="estado estado-abierta">âœ… Caja Abierta</div>
        <div class="acciones">
          <a href="{% url 'cerrar_caja' caja.id %}" class="btn-cerrar"
             onclick="return confirm('Â¿Seguro que deseas cerrar la caja de hoy?')">
            ðŸ”’ Cerrar Caja
          </a>
        </div>
      {% else %}
        <div class="estado estado-cerrada">ðŸ”’ Caja Cerrada</div>
        <p class="texto-mutedo">La caja de hoy ya fue cerrada.</p>
      {% endif %}
    {% else %}
      <!-- Sin caja abierta -->
      <div class="sin-caja">
        <p class="texto-mutedo">No se abriÃ³ caja hoy.</p>
        <a href="{% url 'abrir_caja' %}" class="btn-abrir">ðŸ’° Abrir Caja</a>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
body { background:#0a0a0a; color:#fff; font-family:'Poppins',sans-serif; }
#particles-bg { position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events:none; }

.detalle-caja-container {
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:80vh;
  padding:1rem;
}
.detalle-caja-card {
  background:#111;
  padding:2rem;
  border-radius:1.2rem;
  box-shadow:0 0 25px rgba(0,255,127,0.2);
  width:100%;
  max-width:500px;
  animation: fadeIn 0.4s ease-in-out;
}

.titulo { text-align:center; margin-bottom:0.5rem; }
.subtitulo { text-align:center; font-size:0.95rem; margin-bottom:1.5rem; }

.info-line {
  display:flex;
  justify-content:space-between;
  background:#1b1b1b;
  padding:0.7rem 1rem;
  border-radius:0.6rem;
  margin-bottom:0.7rem;
  font-size:1rem;
  box-shadow:0 0 10px rgba(0,255,127,0.05);
}

.estado {
  text-align:center;
  margin:1rem 0;
  font-weight:600;
  padding:0.5rem;
  border-radius:0.5rem;
}
.estado-abierta { background:rgba(0,255,127,0.1); color:#00ff7f; }
.estado-cerrada { background:rgba(255,99,71,0.1); color:#ff6347; }

.acciones { text-align:center; }
.btn-cerrar, .btn-abrir {
  display:inline-block;
  padding:0.8rem 1.2rem;
  border-radius:0.6rem;
  color:#fff;
  text-decoration:none;
  font-weight:600;
  transition:transform 0.2s ease, box-shadow 0.2s ease;
}
.btn-cerrar { background:#ff4d4d; }
.btn-cerrar:hover { background:#e63939; transform:scale(1.05); box-shadow:0 0 15px #ff4d4d; }

.btn-abrir { background:#00bfff; }
.btn-abrir:hover { background:#009acd; transform:scale(1.05); box-shadow:0 0 15px #00bfff; }

@keyframes fadeIn {
  from { opacity:0; transform:translateY(10px); }
  to { opacity:1; transform:translateY(0); }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// PartÃ­culas de fondo
const canvas = document.getElementById('particles-bg');
const ctx = canvas.getContext('2d');
let particles = [];
function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function initParticles(num=30){
  particles = [];
  for(let i=0;i<num;i++){
    particles.push({
      x: Math.random()*canvas.width,
      y: Math.random()*canvas.height,
      radius: Math.random()*2+1,
      color: ['#39ff14','#fffa00','#ff2e2e','#00bfff'][Math.floor(Math.random()*4)],
      dx: (Math.random()-0.5)*1,
      dy: (Math.random()-0.5)*1
    });
  }
}
initParticles();

function animateParticles(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  particles.forEach(p=>{
    p.x+=p.dx; p.y+=p.dy;
    if(p.x<0||p.x>canvas.width) p.dx*=-1;
    if(p.y<0||p.y>canvas.height) p.dy*=-1;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.radius,0,Math.PI*2);
    ctx.fillStyle=p.color;
    ctx.fill();
  });
  requestAnimationFrame(animateParticles);
}
animateParticles();
</script>
{% endblock %}
